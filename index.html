<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>교원 연수비 지원 신청</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 기본 글꼴 설정 */
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .container { max-width: 600px; }
        .input-style {
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 0.5rem; /* rounded-lg */
            width: 100%;
            transition: all 0.2s;
        }
        .input-style:focus {
            border-color: #3b82f6; /* blue-500 */
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
        }
        .required-label::after {
            content: ' *';
            color: #ef4444; /* red-500 */
            margin-left: 4px;
        }

        /* 로딩 스피너 애니메이션 */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff; /* 흰색 스피너 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-100">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">
                2025. 목포이로초 교원 자율연수비 지원 신청
            </h1>
            <p class="text-gray-500 mb-8 text-center">
                아래 항목을 모두 입력하신 후 제출해 주세요.
            </p>

            <form id="supportForm" class="space-y-6">
                
                <!-- 1. 직위 (Dropdown) -->
                <div>
                    <label for="position" class="block text-sm font-medium text-gray-700 required-label">직위</label>
                    <select id="position" name="position" class="input-style mt-1">
                        <option value="" disabled selected>직위를 선택하세요</option>
                        <option value="교장">교장</option>
                        <option value="교감">교감</option>
                        <option value="교사">교사</option>
                    </select>
                </div>

                <!-- 2. 성명 (Text) -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 required-label">성명</label>
                    <input type="text" id="name" name="name" placeholder="이름을 입력하세요" class="input-style mt-1">
                </div>

                <!-- 3. 지원 분야 (Dropdown) -->
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700 required-label">지원 분야</label>
                    <select id="category" name="category" class="input-style mt-1">
                        <option value="" disabled selected>지원 분야를 선택하세요</option>
                        <option value="직무연수">직무연수</option>
                        <option value="자격취득">자격취득</option>
                        <option value="학원수강">학원수강</option>
                        <option value="도서구입">도서구입</option>
                        <option value="대학(원) 학비">대학(원) 학비</option>
                    </select>
                </div>

                <!-- 4. 과정명 (Text) -->
                <div>
                    <label for="courseName" class="block text-sm font-medium text-gray-700 required-label">과정명/도서명</label>
                    <input type="text" id="courseName" name="courseName" placeholder="과정명 또는 도서명을 입력하세요" class="input-style mt-1">
                </div>

                <!-- 5. 금액 (Number) -->
                <div>
                    <label for="amount" class="block text-sm font-medium text-gray-700 required-label">금액 (원)</label>
                    <input type="number" id="amount" name="amount" placeholder="숫자만 입력 (예: 150000)" class="input-style mt-1" min="0">
                </div>

                <!-- 제출 버튼 -->
                <button type="submit" id="submitButton" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out">
                    신청서 제출
                </button>
            </form>
            
            <!-- 응답 메시지 영역 -->
            <div id="messageBox" class="mt-6 p-4 rounded-lg text-center hidden" role="alert"></div>

        </div>
    </div>
    
    <!-- 로딩 모달 (화면 전체를 덮고 가운데에 스피너 표시) -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
        <div class="p-6 rounded-lg text-white text-lg flex flex-col items-center">
            <div class="spinner mb-3"></div>
            <p>신청서 제출 중...</p>
            <p class="text-sm text-gray-300 mt-1">잠시만 기다려 주세요.</p>
        </div>
    </div>

    <script>
        document.getElementById('supportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const messageBox = document.getElementById('messageBox');
            const submitButton = document.getElementById('submitButton');
            const loadingModal = document.getElementById('loadingModal');
            
            // 헬퍼 함수: 모달 표시/숨기기
            function toggleLoading(show) {
                if (show) {
                    loadingModal.classList.remove('hidden');
                } else {
                    loadingModal.classList.add('hidden');
                }
            }

            // 헬퍼 함수: 메시지 표시
            function showMessage(text, classes) {
                if (text) {
                    messageBox.textContent = text;
                    messageBox.className = `mt-6 p-4 rounded-lg text-center ${classes}`;
                    messageBox.classList.remove('hidden');
                } else {
                    messageBox.classList.add('hidden');
                    messageBox.className = 'mt-6 p-4 rounded-lg text-center hidden';
                }
            }
            
            // 1. 유효성 검사 (모든 항목이 비어 있지 않은지 확인)
            const position = document.getElementById('position').value;
            const name = document.getElementById('name').value.trim();
            const category = document.getElementById('category').value;
            const courseName = document.getElementById('courseName').value.trim();
            const amount = document.getElementById('amount').value.trim();

            if (!position || !name || !category || !courseName || !amount) {
                showMessage('모든 필수 항목을 입력해 주세요.', 'bg-red-100 text-red-700');
                return;
            }

            // 2. 버튼 비활성화 및 로딩 모달 표시
            submitButton.disabled = true;
            showMessage('', ''); // 메시지 초기화
            toggleLoading(true); // 로딩 모달 표시
            
            // Apps Script URL. 실제 URL로 변경해 주세요.
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxbskKEoFX07ehzuexGH3QvmY_31CNLfPhI8HBAQXs3mysq0hbBlrs--GurC_o0GUEe/exec'; 

            // 3. FormData 객체 생성
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // 4. Fetch를 이용한 POST 요청 (Exponential Backoff 포함)
            const MAX_RETRIES = 5;
            let currentRetry = 0;

            async function submitData() {
                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', 
                        body: new URLSearchParams(data)
                    });
                    
                    // no-cors 모드에서는 응답 확인이 어려우므로 성공으로 간주하고 메시지 표시
                    showMessage('✅ 신청이 성공적으로 제출되었습니다. 감사합니다!', 'bg-green-100 text-green-700');
                    form.reset(); // 성공 시 폼 초기화

                } catch (error) {
                    if (currentRetry < MAX_RETRIES) {
                        const delay = Math.pow(2, currentRetry) * 1000; 
                        currentRetry++;
                        setTimeout(submitData, delay);
                    } else {
                        showMessage('❌ 제출 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.', 'bg-red-100 text-red-700');
                    }
                } finally {
                    // 성공 또는 최종 실패 시 버튼 복구 및 모달 숨기기
                    submitButton.disabled = false;
                    toggleLoading(false); // 로딩 모달 숨기기
                }
            }
            
            submitData();
        });
    </script>
</body>
</html>
